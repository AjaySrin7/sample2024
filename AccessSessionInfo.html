<!DOCTYPE html>
<html>
<head>
  <style>
    .iframe-container {
      width: 100%; 
      height: 80vh; 
      margin-top: 20px; 
    }

    .iframe-container iframe {
      width: 100%; 
      height: 100%; 
      border: none; 
    }
  </style>
</head>
<body>
  <div>
    <h1>This is a test add-in to demonstrate sending user's session info outside externally</h1>
    <button id="myBtn">Send user info</button> 
  </div>

  <div class="iframe-container"> 
    <iframe id="myIframe" src=""></iframe> 
  </div>

  <script>
    geotab.addin.myCustomPage1 = () => {
      return {
        initialize(api, state, callback) {
          const myButton = document.getElementById("myBtn");
          const myIframe = document.getElementById("myIframe"); // Get the iframe element

          myButton.addEventListener("click", function() {
            api.getSession(function(session, server) {
              console.log("Sending session info to remote server:", session);

              setTimeout(function() {
                const approvalToken = "simulated_approval_token"; 

                if (approvalToken) {
                  myIframe.src = "https://www.wikipedia.org"; // Set the iframe source
                } else {
                  console.error("Invalid approval token");
                }
              }, 1000); 
            });
          });

          callback();
        },
        focus(api, state) {
          console.log('User has clicked the add-in and is focused on the UI');
        },
        blur(api, state) {
          console.log('User has navigated away from the add-in');
        }
      };
    };
  </script>
</body>
</html>
